define("jira/ajs/select/security/default-comment-security-level-model",["jira/lib/class","jquery","wrm/context-path"],function(Class,jQuery,contextPath){return Class.extend({DEFAULT_COMMENT_SECURITY_LEVEL_KEY_PREFIX:"default-comment-security-level-",_currentDefault:null,_preferenceKey:null,init:function(projectId){this.NOT_SELECTED_DEFAULT=new this.LvlObj("","");this._preferenceKey=this.DEFAULT_COMMENT_SECURITY_LEVEL_KEY_PREFIX+projectId},LvlObj:function(level,levelName){this.level=level;this.levelName=levelName},_isLvlObjValid:function(lvlObj){return !(lvlObj["level"]==undefined||lvlObj["levelName"]==undefined)},_getDefaultStoreRequest:function(lvlObj){return jQuery.ajax({url:contextPath()+"/rest/api/2/mypreferences?key="+this._preferenceKey,type:"PUT",contentType:"application/json",dataType:"json",data:JSON.stringify(lvlObj)})},_getDefaultLoadRequest:function(){return jQuery.ajax({url:contextPath()+"/rest/api/2/mypreferences?key="+this._preferenceKey,type:"GET",contentType:"application/json",dataType:"json"})},updateDefault:function(lvlObj,onSuccess,onError){this._sendDefaultChangedAnalytics(lvlObj);this._getDefaultStoreRequest(lvlObj).done(function done(data){this._currentDefault=lvlObj;onSuccess()}.bind(this)).fail(function fail(xhr){onError(xhr)})},getDefault:function(onSuccess,onError){if(this._currentDefault==null){this._getDefaultLoadRequest().done(function done(data){if(this._isLvlObjValid(data)){this._currentDefault=data}else{this._currentDefault=this.NOT_SELECTED_DEFAULT}onSuccess(this._currentDefault)}.bind(this)).fail(function fail(xhr){if(xhr.status==404){this._currentDefault=this.NOT_SELECTED_DEFAULT;onSuccess(this._currentDefault)}else{onError(xhr)}}.bind(this))}else{onSuccess(this._currentDefault)}},getCurrentDefault:function(){return this._currentDefault},_sendDefaultChangedAnalytics:function(lvlObj){AJS.trigger("analyticsEvent",{name:"jira.issue.comment.level.default.set",data:{projectId:this.projectId,issueId:JIRA.Issue.getIssueId(),newDefault:lvlObj}})}})});