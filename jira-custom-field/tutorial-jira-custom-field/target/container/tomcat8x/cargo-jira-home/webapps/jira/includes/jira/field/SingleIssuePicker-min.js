define("jira/field/single-issue-picker",["jira/ajs/select/single-select","jira/ajs/list/group-descriptor","jira/ajs/list/item-descriptor","jira/ajs/ajax/smart-ajax","jquery"],function(SingleSelect,GroupDescriptor,ItemDescriptor,SmartAjax,jQuery){var SingleIssuePicker=SingleSelect.extend({_formatResponse:function(response){var ret=[],canonicalBaseUrl=(function(){var uri=parseUri(window.location);return uri.protocol+"://"+uri.authority})();if(response&&response.sections){var skipCs=false;jQuery(response.sections).each(function(i,section){if(section.id==="hs"){if(section.issues&&section.issues.length>0){skipCs=true}}});jQuery(response.sections).each(function(i,section){if(!(section.id==="cs"&&skipCs)){var groupDescriptor=new GroupDescriptor({weight:i,label:section.label,description:section.sub});if(section.issues&&section.issues.length>0){jQuery(section.issues).each(function(){groupDescriptor.addItem(new ItemDescriptor({highlighted:true,value:this.key,label:this.key+" - "+this.summaryText,icon:this.img?canonicalBaseUrl+contextPath+this.img:null,html:this.keyHtml+" - "+this.summary}))})}ret.push(groupDescriptor)}})}return ret},_getDefaultOptions:function(){return jQuery.extend(true,this._super(),{ajaxOptions:{formatResponse:this._formatResponse.bind(this),error:function(){this.showErrorMessagePlain(this.buildHttpErrorMessage(arguments[3]))}.bind(this)}})},_createFurniture:function(disabled){this._super(disabled);this.$container.addClass("jira-issue-picker");this.$container.addClass("hasIcon")},_setOptions:function(options){this._super(options);var skipKeys=this.options.skipKeys||"";this.options.ajaxOptions.data.currentJQL="";if(skipKeys!==""){this.options.ajaxOptions.data.currentJQL="issuekey not in ("+this.options.skipKeys+")"}return undefined},setCurrentProjectId:function(projectId){this.options.ajaxOptions.data.currentProjectId=projectId},getQueryVal:function(){return jQuery.trim(this.$field.val())},showErrorMessagePlain:function(value){var $container=this.$container.parent(".field-group");this.hideErrorMessage();this.$errorMessage.text(value);if($container.length===1){$container.append(this.$errorMessage);return }if($container.length===0){$container=this.$container.parent(".frother-control-renderer")}if($container.length===1){this.$errorMessage.prependTo($container);return }if($container.length===0){this.$container.parent().append(this.$errorMessage)}},buildHttpErrorMessage:function(smartAjaxResult){var AJS=window.top.AJS;var errMsg;if(smartAjaxResult.statusText===SmartAjax.SmartAjaxResult.TIMEOUT){errMsg=AJS.I18n.getText("common.forms.ajax.timeout")}else{if(smartAjaxResult.status===401){errMsg=AJS.I18n.getText("common.forms.ajax.unauthorised.alert")}else{if(smartAjaxResult.hasData){errMsg=AJS.I18n.getText("common.forms.ajax.servererror")}else{errMsg=AJS.I18n.getText("common.forms.ajax.commserror")}}}return errMsg}});return SingleIssuePicker});